# -----------------------------
# Authentication / Token Logic
# -----------------------------

type Query {
  """
  Perform login and return full JSON response from REST endpoint.
  """
  _login: JSON
    @rest(
      method: POST
      endpoint: "https://qnap-jiri.myqnapcloud.com/classic-models/api/auth/login/"
      configuration: "classic_models"
      tls: "classic_models"
      headers: [
        { name: "Content-Type", value: "application/json" }
      ]
      postbody: """
      {
        "username": "demo",
        "password": "demo123"
      }
      """
    )

  """
  Inject login JSON into downstream queries.
  Downstream queries can reference $access for the token in headers.
  Must return JSON type for @inject.
  The @inject directive automatically injects the access token from _inject_token.access
  into queries matching the pattern.
  """
  _inject_token: JSON
    @materializer(query: "_login")
    @inject(
      on: { expose: true, types: "Query", fields: "customer.*|customers|customerOrders|customerPayments|orderDetails|productLine.*|productLines|productLineProducts" }
    )
}