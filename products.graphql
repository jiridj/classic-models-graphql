type ProductLine {
  productline: String!
  textdescription: String
  htmldescription: String
  image: String
  products: [Product!]
}

type Product {
  productcode: String!
  productname: String!
  productline: String!
  productscale: String!
  productvendor: String!
  productdescription: String!
  quantityinstock: Int!
  buyprice: String!
  msrp: String!
}

type OrderDetail {
  id: Int!
  ordernumber: Int!
  productcode: String!
  quantityordered: Int!
  priceeach: String!
  orderlinenumber: Int!
  product: Product
    @materializer(
      query: "__product"
      arguments: [
        { name: "productcode", field: "productcode" }
      ]
    )
}

type Order {
  ordernumber: Int!
  orderdate: String!
  requireddate: String
  shippeddate: String
  status: String!
  comments: String
  customernumber: Int!
  orderdetails: [OrderDetail!]
    @materializer(
      query: "__orderDetails"
      arguments: [
        { name: "ordernumber", field: "ordernumber" }
      ]
    )
}

type Customer {
  customernumber: Int!
  customername: String!
  contactlastname: String!
  contactfirstname: String!
  phone: String!
  addressline1: String!
  addressline2: String
  city: String!
  state: String
  postalcode: String
  country: String!
  salesrepemployeenumber: Int
  creditlimit: String
  orders: [Order!]
}

type Query {
  """
  Internal query to fetch customer by customer number.
  """
  _customer(token: Secret!, customernumber: Int!): Customer
    @rest(
      endpoint: "https://qnap-jiri.myqnapcloud.com/classic-models/api/v1/customers/$customernumber/"
      configuration: "classic_models"
      tls: "classic_models"
      headers: [
        { name: "Authorization", value: "Bearer $token" }
      ]
    )

  """
  Internal query to fetch orders for a customer.
  """
  _customerOrders(token: Secret!, customernumber: Int!): [Order!]!
    @rest(
      endpoint: "https://qnap-jiri.myqnapcloud.com/classic-models/api/v1/customers/$customernumber/orders/"
      configuration: "classic_models"
      tls: "classic_models"
      headers: [
        { name: "Authorization", value: "Bearer $token" }
      ]
    )

  """
  Internal query to fetch order details for an order (requires token).
  """
  _orderDetails(token: Secret!, ordernumber: Int!): [OrderDetail!]!
    @rest(
      endpoint: "https://qnap-jiri.myqnapcloud.com/classic-models/api/v1/orders/$ordernumber/orderdetails/"
      configuration: "classic_models"
      tls: "classic_models"
      headers: [
        { name: "Authorization", value: "Bearer $token" }
      ]
    )

  """
  Internal query to fetch order details (authenticates internally).
  """
  __orderDetails(ordernumber: Int!): [OrderDetail!]!
    @sequence(
      steps: [
        { query: "_login" }
        {
          query: "_orderDetails"
          arguments: [
            { name: "token", field: "ยง0.access" }
            { name: "ordernumber", argument: "ordernumber" }
          ]
        }
      ]
    )

  """
  Internal query to fetch a product by product code (requires token).
  """
  _product(token: Secret!, productcode: String!): Product
    @rest(
      endpoint: "https://qnap-jiri.myqnapcloud.com/classic-models/api/v1/products/$productcode/"
      configuration: "classic_models"
      tls: "classic_models"
      headers: [
        { name: "Authorization", value: "Bearer $token" }
      ]
    )

  """
  Internal query to fetch a product (authenticates internally).
  """
  __product(productcode: String!): Product
    @sequence(
      steps: [
        { query: "_login" }
        {
          query: "_product"
          arguments: [
            { name: "token", field: "ยง0.access" }
            { name: "productcode", argument: "productcode" }
          ]
        }
      ]
    )

  """
  Get complete order history for a customer.
  
  This query demonstrates the power of GraphQL over REST:
  - Fetches customer information, all orders, order details, and product info in a single request
  - In REST, this would require multiple API calls:
    1. GET /customers/{id}/
    2. GET /customers/{id}/orders/
    3. For each order: GET /orders/{id}/orderdetails/
    4. For each order detail: GET /products/{code}/
  
  With GraphQL, you can fetch all this nested data in one query and select only the fields you need.
  """
  customerOrderHistory(customernumber: Int!): Customer
    @sequence(
      steps: [
        { query: "_login" }
        {
          query: "_customer"
          arguments: [
            { name: "token", field: "ยง0.access" }
            { name: "customernumber", argument: "customernumber" }
          ]
        }
        {
          query: "_customerOrders"
          arguments: [
            { name: "token", field: "ยง0.access" }
            { name: "customernumber", argument: "customernumber" }
          ]
          setters: [
            { field: "orders", path: "$" }
          ]
        }
      ]
    )
}
